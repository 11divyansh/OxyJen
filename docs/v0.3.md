## Oxyjen v0.3 Documentation

**Version:** 0.3.0  
**Status:** In Development  
**Focus:** Structured Intelligence — Prompts, Schemas, Reliable Outputs  

---

## Overview

Oxyjen v0.3 introduces structured intelligence to Java AI pipelines.

Instead of unpredictable text, you can now enforce JSON schemas, validate model output, and automatically retry until the structure is correct.

At the core:

- Prompt templates for reusable prompts
- JSON schemas for structured outputs
- Automatic validation + retry
- SchemaNode for graph integration

---

## What v0.3 Solves

### Before v0.3

```java
String response = model.chat("Extract person info: John Smith, age 30");
// Could be anything:
// "John Smith is 30"
// "{ name: John }"
// invalid JSON
// random formats
```
### With v0.3
```java
JSONSchema schema = JSONSchema.object()
    .property("name", PropertySchema.string("Person name"))
    .property("age", PropertySchema.number("Person age"))
    .required("name", "age")
    .build();

SchemaEnforcer enforcer = new SchemaEnforcer(model, schema);

String json = enforcer.execute(
    "Extract person info: John Smith, age 30"
);
```

// Always valid JSON:
// {"name":"John Smith","age":30}
##Core Concepts
**Prompt Templates**
- Prompt templates let you define prompts with variables and fill them at runtime.

**Basic Usage**
```java
PromptTemplate template = PromptTemplate.of(
    "Hello {{name}}, you are {{age}} years old."
);

String result = template.render(
    "name", "Alice",
    "age", 25
);
```
**Required / Optional Variables**
```java
PromptTemplate template = PromptTemplate.of(
    "Hello {{name}}, role: {{role}}",
    Variable.required("name"),
    Variable.optional("role", "guest")
);

// Uses default role
template.render("name", "Alice");

// Override default
template.render("name", "Bob", "role", "admin");
```
Variables are provided at execution time, not on nodes.

**JSON Schema**
JSONSchema defines the structure your LLM output must follow.

***Creating a Schema***
```java
JSONSchema schema = JSONSchema.object()
    .description("Person information")
    .property("name", PropertySchema.string("Full name"))
    .property("age", PropertySchema.number("Age"))
    .property("active", PropertySchema.bool("Is active"))
    .property("status", PropertySchema.enumOf(
        "Account status",
        "active", "inactive", "pending"
    ))
    .required("name", "age")
    .build();
```
**Supported types in v0.3:**
- string
- number
- boolean
- enum (string with fixed values)

**Schema Validation**
Validate any JSON string against a schema.
```java
SchemaValidator validator = new SchemaValidator(schema);

ValidationResult result = validator.validate(json);

if (!result.isValid()) {
    System.out.println(result.formatErrors());
}
```
***ValidationResult exposes:***
- isValid()
- errors() → List<FieldError>
- formatErrors()

***Each FieldError includes:***
- fieldPath
- errorType
- expected
- received
- message

**Schema Enforcement**
SchemaEnforcer automatically retries the model until valid JSON is produced (or retries are exhausted).
```java
SchemaEnforcer enforcer =
    new SchemaEnforcer(model, schema, 3);

String json = enforcer.execute(
    "Extract person info from: Alice Smith is 30"
);
```
Internally:

LLM → validate → retry with errors → repeat
If all retries fail, SchemaException is thrown.

**SchemaNode (Graph Integration)**
SchemaNode combines:

- ChatModel

- JSONSchema

- SchemaEnforcer

It acts as the boundary between text and structured data.

Signature (v0.3):

String → Map<String,Object>
Creating a SchemaNode:
```java
SchemaNode node = SchemaNode.builder()
    .model("gpt-4o-mini")
    .schema(schema)
    .memory("extractions")
    .build();
```
---

##Public API (v0.3)
##Prompts
- PromptTemplate.of(...)
- template.render(...)
- Variable.required(...)
- Variable.optional(...)

##Schema
- JSONSchema.object()
- PropertySchema.string(...)
- PropertySchema.number(...)
- PropertySchema.bool(...)
- PropertySchema.enumOf(...)

##Validation
- SchemaValidator.validate(...)
- ValidationResult
- FieldError
- Enforcement
- SchemaEnforcer.execute(...)
- SchemaException

##Graph
- SchemaNode.builder()...
- SchemaNode.process(...)

---

##Migration from v0.2
v0.3 is backward compatible.

You can still use:

model.chat(...)

---

##Mental Model
PromptTemplate = reusable prompt

JSONSchema = output contract

SchemaEnforcer = retry loop

SchemaNode = graph boundary (text → data)

---
